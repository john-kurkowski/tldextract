name: CI
on: [push, pull_request]
jobs:
  test-and-coverage:
    strategy:
      fail-fast: false
      matrix:
        os: [macos-latest, windows-latest, ubuntu-latest]
        python-version:
          [
            ["3.8", "py38"],
            ["3.9", "py39"],
            ["3.10", "py310"],
            ["3.11", "py311"],
            ["3.12", "py312"],
            ["pypy3.9", "pypy39"],
            ["pypy3.10", "pypy310"],
            ["3.8", "codestyle"],
            ["3.8", "lint"],
            ["3.8", "typecheck"],
          ]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version[0] }}
      - name: Install Python requirements
        run: |
          pip install --upgrade pip
          pip install --upgrade --editable '.[testing]'
      - name: Test
        run: tox
        env:
          TOXENV: ${{ matrix.python-version[1] }}
